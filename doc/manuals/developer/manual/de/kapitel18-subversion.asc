////////////////////////////////////////////////////////////////////////////////

This file belongs to "Clansuite - just an eSports CMS" as part of the "Clansuite Documentation".
This file is written in ASCIIDOC format. It's dual-licensed under the GNU Free Documentation License,
Version 1.3 and the Creative Commons Attribution-Share-Alike 3.0 License (cc-by-sa).

You find a comprehensive AsciiDoc UserGuide here:
http://www.methods.co.nz/asciidoc/userguide.html

You find a Ascii Doc SheetCheat here:
http://powerman.name/doc/asciidoc-compact

For the Clansuite Documentation visit:
http://www.clansuite.com/documentation/

SVN: $Id$

////////////////////////////////////////////////////////////////////////////////

== Subversion (SVN) - Sourcecode-Versionsverwaltung

=== Wie kann man mit mehreren Entwicklern effizient SourceCode gleichzeitig bearbeiten?

Dazu stellt man eine zentrale Verwaltung aller Quelltext-Dateien zur Verfügung.
Dabei ist der Zugriff steuerbar, beispielsweise Lesen für jedermann und Schreiben nur für Entwickler.

Man hält zu jeder Datei, nicht nur die zuletzt gespeicherte Version vor, sondern auch alle früheren.
Demnach lassen sich Änderungen an der Datei sehr einfach verfolgen, denn jede Übermittlung einer
Dateiänderung erzeugt eine neue Version.

Bei paralleler Bearbeitung und anschließender Speicherung kommt es zu einem Versionskonflikt.
Dieser kann durch Zusammenführung der beiden Dateiinhalte ausgeglichen werden.

=== Wie ist das Subversion Archiv aufgebaut?

Das Versionsverwaltungsarchiv auf dem Server wird auch "repository" genannt.
Die Arbeitskopie auf dem eigenen Rechner nennt man "working copy".

Es hat sich als zweckmäßig erwiesen folgende Struktur zu verwenden:

[source, txt]
---------------------------------------------------------------------
/branches    Ein Ast der Entwicklung : ermöglicht Weiterentwicklung in einem extra Bereich, bei Erfolg wird "branch" in "trunk" eingefügt
/tags        Ablagebereich für benannte Versionen, z. B. Produkt X Version alpha
/trunk       Der Stamm der Entwicklung : Hauptentwicklungsbereich
---------------------------------------------------------------------

Benennung der Versionen:

[source, txt]
---------------------------------------------------------------------
"revision"   gibt das Archiv mit der jeweiligen Version wieder, zB rev 1 = erste Version
"head"       gibt das Archiv in der aktuellsten Version (meint regelmäßig die letzte Änderung am /trunk)
---------------------------------------------------------------------

=== Der Arbeitsablauf mit Subversion

Wie läuft das nun genau ab?
Es lassen sich 3 Arbeitsschritte benennen. Das Holen, das Aktualisieren und das Hochladen.

.Das Holen - Checkout
Zunächst werden alle Daten vom Server geholt.
Diesen Vorgang bezeichnet man als "checkout". Es ist der Erstbezug des Quellcodes.
Dadurch wird eine lokale Arbeitskopie erzeugt.

.Das Aktualisieren - Update
Neuerungen auf dem Server kann man mittels "update" in die lokale Arbeitskopie einpflegen. So hält man die
"working copy" auf dem neuesten Stand. Sollte eine lokale Datei jedoch verändert worden sein, wird ein
Zusammenführen der alten (lokalen) und neuen (server-repos) ermöglicht.
Diesen Vorgang nennt man "mergen", im Sinne einer Versionsverbindung.

.Das Hochladen - Commit
Mittels "commit" werden die lokal durchgeführten Veränderungen an das zentrale Repository übertragen und
erzeugen dort eine neue Revisionsnummer (den Head, die aktuellste verfügbare Version),
wenn die Serverdateien nicht zwischenzeitlich selbst geändert worden sind.
Falls zwischenzeitlich eine Veränderung des Archivs durch einen anderen Entwickler erfolgt ist,
wird ein Zusammenführen (das sogennte "mergen") der eigenen lokalen Datei und der Serverdatei ermöglicht.
Hiernach stehen alle Änderungen allen anderen Entwicklern zur Verfügung.

=== Der Zugriff auf das Clansuite Subversion Archiv

Das Clansuite Subersion Repository liegt auf dem Server von "http://gna.org".

==== Welche Zugriffsmöglichkeiten gibt es?

Es gibt 2 Zugriffsarten auf das SVN: (A) öffentlich (anonym) und (B) privat (registriert).

Der "öffentliche" Zugriff steht jedem zur Verfügung.

Der "private" Zugriff erfordert die Erstellung eines Nutzerkontos bei GNA.
Dazu ist die Hinterlegung des SSH-Keys auf dem Gna-Server und die Aktivierung der verschlüsselten
Verbindung auf dem lokalen Rechner erforderlich.

Dabei kann die Generierung des Keys für die Verschlüsselung über "puttygen" erfolgen.
Die lokale Aktivierung des Verbindungstunnel kann mittels "Pageant" durchgeführt werden.
Beide Anwendungen sind Bestandteil des Programmpakets "putty".

==== Womit kann ich das am besten machen?

Für beide bietet sich als SVN Verwaltungsprogramm "TortoiseSVN" an.
Du kannst es über diesen Link downloaden: http://tortoisesvn.net/downloads (Tortoise SVN Downloads).

=== (A) Der öffentliche Zugriff ( für Nicht-Mitglieder des Projekts )

Der öffentliche SVN Zugriff steht jedermann zur Verfügung.
Die Verbindungs-Urls für das Clansuite SVN lautet:

[source, txt]
---------------------------------------------------------------------
http://svn.gna.org/svn/clansuite/trunk
---------------------------------------------------------------------

Du kannst sie direkt in Tortoise Checkout einfügen, ein Zielverzeichnis angeben und es erfolgt ein
Checkout (das Holen der Dateien, siebe oben) des Trunk (aktuellste Version, siehe oben).
Oder als Konsolenbefehl für SVN:

[source, txt]
---------------------------------------------------------------------
svn co http://svn.gna.org/svn/clansuite/trunk clansuite
---------------------------------------------------------------------

=== (B) Privater Zugriff (für Clansuite Projekt Mitglieder)

Der "private" Zugriff erfordert
(1) die Erstellung eines Nutzerkontos bei GNA,
(2) die Hinterlegung des SSH-Keys auf dem Gna-Server und die Aktivierung der verschlüsselten Verbindung
auf dem lokalen Rechner. Dabei erfolgt die Generierung des Keys über "puttygen".
Die lokale Aktivierung mittels "Pageant". Beide Anwendungen kommen mit "putty".

.Schritt 1: Bei Gna.org registrieren
Wenn Sie mitmachen und Quellcode beisteuern möchten, dann legen Sie sich zunächst ein Benutzerkonto bei GNA an.
Die Seite mit der Benutzerkontoanzeige können Sie im Browser geöffnet lassen, wir brauchen sie gleich nochmal.

.Schritt 2: Für sichere Verbindung zum GNA Server sorgen
Jetzt ist es an der Zeit sich um eine sichere Verbindung von Ihrem Rechner zum GNA Server zu kümmern.
Das erfolgt in drei kleineren Schritten:
(1) Als ersten erstellen Sie einen öffentlichen SSH-Schlüssel, zu dem nur Sie das Passwort kennen.
(2) Diesen hinterlegen Sie dann auf dem GNA Server.
(3) Danach aktivieren Sie diesen Schlüssel lokal und geben das Passwort ein.

==== Den Öffentlichen Schlüssel erstellen

Einen öffentlichen Schlüssel kann man mit dem Programm "puttygen" erstellen.
"Puttygen" wird mit "Putty" installiert und liegt dann im Installationspfad von "Putty".

Putty Website
http://www.chiark.greenend.org.uk/~sgtatham/putty/

Download: Latest Putty Installer
http://tartarus.org/~simon/putty-snapshots/x86/putty-installer.exe

Download: Putty 0.60 Installer
http://the.earth.li/~sgtatham/putty/latest/x86/putty-0.60-installer.exe

Wenn Du "puttygen" gestartet hast, gehst Du auf "Generate Key".(Parameterhinweis: SSH2-RSA 1024)
Zu diesem Schlüssel gibst Du nun Dein Passwort (Keyphrase) ein.
Um Tippfehler auszuschließen gibst Du es nochmals ein.

Jetzt hast Du einen SSH-Schlüssel mit Passwort. Du speicherst sowohl "Private" als auch "Public" Schlüssel ab.

==== Den öffentlichen Schlüssel bei GNA hinterlegen

Um den Schlüssel bei GNA zu hinterlegen kopierst Du den kompletten Inhalt (vom ersten bis zum letzten Zeichen)
der Schlüsselanzeige (das oberste Formularfeld) aus "Puttygen" in die Zwischenablage.

Das Browserfenster mit der Benutzerkontoanzeige bei GNA ist noch geöffnet und Du gehst auf SSH-Keys hinzufügen.
Alternativ kannst Du diesen Link verwenden: https://gna.org/my/admin/editsshkeys.php , wenn Du noch angmeldet bist.

Rest erklärt sich von selbst: den Inhalt der Zwischenablage in ein Schlüssel-Inputfeld einfügen.
Saven und fertig: Schlüssel ist bei GNA hinterlegt. (Beispiel: ssh-rsa AAAAblalba123blabla==)

(Zusatzinformation: Damit dieser Schlüssel für das SVN auf dem GNA Server aktiv wird, muss erst die
Rechtetabelle aktualisiert werden. Der Eintrag mittels CronJob dauert zwischen 30 und 60 Minuten.
Also später nicht wundern, dass man nicht sofort gesichert zugreifen kann.)

==== Den öffentlichen Schlüssel lokal aktivieren

Um den Schlüssel nun für jeden Kommunikationsvorgang mit dem GNA Server zur Hand zu haben, startest Du das
Programm "Pageant" (im "Putty" Verzeichnis) und lädst den abgespeicherten Public Private Key
(öffentlicher privater Schlüssel). Die Dateiendung ist PPK. Alternativ kannst Du den Key doppelklicken,
wenn Pageant mit der PPK Endung verknüpft ist, sollte es starten.

Es öffnet sich ein Fenster zur Eingabe Deines Passworts.

Nach erfolgreicher Eingabe taucht in der Taskleiste neben der Uhr ein Symbol "PC mit Hut" auf.
Du kannst hier per "rechts-klick" und "View Keys" prüfen, ob der Key auch geladen wurde.

Wenn dieses Symbol angezeigt wird und der Key hinterlegt ist, kann Dein Rechner über eine
SSH-Verbindung gesichert mit dem GNA Server kommunizieren.

=== Wie ist die Checkout-URL für Projektmitglieder?

Checkouts der Projektmitglieder müssen mitteks einer bestimmten Checkout-URL erfolgen.
Dieses URL-Format ist notwendig, damit später Commits den jeweiligen Usern
zugeordnet und die SSH Keys abgeglichen werden können.

In den nachfolgenden URLs ist <membername> durch den GNA Nickname zu ersetzen!
Die URLs können direkt per Copy/Paste in Tortoise SVN eingefügt werden.

.Checkout-URL des Trunk

[source, txt]
---------------------------------------------------------------------
svn+ssh://<membername>@svn.gna.org/svn/clansuite/trunk
---------------------------------------------------------------------

.Checkout des Trunk in das Verzeichnis /clansuite per Konsole:

[source, txt]
---------------------------------------------------------------------
svn co svn+ssh://<membername>@svn.gna.org/svn/clansuite/trunk clansuite
---------------------------------------------------------------------

=== Wie bekomme ich das gesamte Repository?

Um das gesamte Archiv zu beziehen, kann die folgenden Checkout URL eingesetzt werden.

[source, txt]
---------------------------------------------------------------------
svn+ssh://<membername>@svn.gna.org/svn/clansuite/
---------------------------------------------------------------------

CAUTION: Die Verwendung dieser URL bewirkt das Holen aller Branches, Tags und des zusätzlichen Entwicklermaterials
und kann recht platzgreifend sein! Bei Revision #2350 waren rund 280 MB Festplattenplatz erforderlich.
Diese Größe kommt insbesondere durch das SVN Dateisysten zustande, welches sehr viele kleine Dateien beinhaltet.

=== Wie bekomme ich nur einen Teil des Repositories?

Wenn Du die nachfolgende Checkout URL verwendest, bekommst Du alle Dateien unterhalb
des angegebenen Unterverzeichnisses.

[source, txt]
---------------------------------------------------------------------
svn+ssh://<membername>@svn.gna.org/svn/clansuite/ + unterverzeichnis
---------------------------------------------------------------------

Ein konkretes Beispiel.
Wenn Sie nur an Themes arbeiten, können Sie die folgende URL verwenden:

[source, txt]
---------------------------------------------------------------------
svn+ssh://<membername>@svn.gna.org/svn/clansuite/trunk/themes
---------------------------------------------------------------------

=== Privater Zugriff auf das SVN unter Linux

[NOTE]
.Privater Zugriff auf das SVN unter Linux
=====================================================================
. Schlüssel erstellen
  ssh-keygen -t dsa -b 1024 -C <comment>
. Wo finde ich den Schlüssel?
  Der Schlüssel wird im Verzeichnis des Benutzers abgelegt: ~/.ssh/id_dsa.pub.
. Den Schlüssel aus "id_dsa.pub" bei gna.org eintragen
  Danach kann man eine gute Stunde abwarten, bis der GNA-Cronjob den neuen Schlüssel aufgenommen hat.
  https://gna.org/my/admin/editsshkeys.php
. SSH Verbindung prüfen (Connection Check)
  ssh -v <membername>@svn.gna.org
  Hier müsste eine Fehlermeldung kommen, denn die Anmeldung an der Console ist nicht gestattet.
. SVN-Checkout
  svn co svn+ssh://<membername>@svn.gna.org/svn/clansuite/trunk
=====================================================================

=== Installation von Subversion

==== Subversion Binary Packages

Für die Installation von Subversion stehen verschiedene Binary Packages zur Auswahl
footnote:[http://subversion.apache.org/packages.html].

Linux (Debian)

[source, txt]
---------------------------------------------------------------------
 apt-get install subversion
---------------------------------------------------------------------

Windows

- CollabNet (certified binaries; maintained by CollabNet)
http://www.collab.net/downloads/subversion/

- SilkSVN
http://www.sliksvn.com/en/download

- Tigris.org (Apache 2.2-compatible, Maintainers: D. J. Heap, Branko Cibej und Troy Simpson)
http://subversion.tigris.org/servlets/ProjectDocumentList?folderID=8100

- VisualSVN
http://www.visualsvn.com/server/download/
